# Pi-hole Network Manager - Code Architecture (KDL)
# Ultra-compact knowledge base for AI agent consumption
# Format: <category>::<type>::<name>:<primary-id>|<key>:<value>|<key>:<value>...

# Core Modules
python::module::main:main.py|components:management,core|entry:true|venv:auto-create|exec-model:local
python::module::core-config:core/config.py|features:yaml,encryption|imports:pyyaml,cryptography|router-passwords:encrypted
python::module::core-local-executor:core/local_executor.py|features:subprocess,file-ops,db-query|sudo:passwordless|location:pi
python::module::core-ui:core/ui.py|features:menu,table,status,panel|imports:rich|console:global
python::module::core-state:core/state.py|features:setup-complete-flag|file:/opt/pihole-manager/state.json|simplified:true
python::module::core-logger:core/logger.py|features:session-logging,lifecycle-tracking|pattern:singleton|format:YYYYMMDD-HHMMSS.log|location:/tmp/

# Management Modules (all run locally on Pi)
python::module::mgmt-blocklists:management/blocklists.py|features:profile-switch,custom-lists,gravity-update|pihole:required|exec:local
python::module::mgmt-devices:management/devices.py|features:device-view,dns-override,grouping|pihole:ftl-db|exec:local
python::module::mgmt-lists:management/lists.py|features:whitelist,blacklist,regex,gravity|pihole:gravity-db|exec:local
python::module::mgmt-content-filter:management/content_filter.py|features:time-based-blocking,device-rules|manual-enforcement:true|exec:local
python::module::mgmt-stats:management/stats.py|features:query-dashboard,top-clients,query-log|pihole:ftl-db|exec:local
python::module::mgmt-router:management/router_control.py|features:device-list,mac-blocking,dhcp|router:tplink-axe5400|ssh:pi-to-router
python::module::mgmt-maintenance:management/maintenance.py|features:updates,restart,resources,service-status|sudo:passwordless|exec:local
python::module::mgmt-health:management/health.py|features:dns-test,service-check,db-integrity|diagnostics:full|exec:local

# Pi Setup Scripts (runs once on Raspberry Pi)
bash::script::initial-setup:pi-setup/initial-setup.sh|features:system-deps,sudoers,venv,state|sudo:required|run-once:true
config::template::sudoers:pi-setup/templates/sudoers-pihole-manager|grants:pihole-commands|passwordless:true|installs:/etc/sudoers.d/

# Blocklist Profiles
pihole::profile::light:pi-setup/profiles/light.yaml|domains:~100k|lists:stevenblack,adguard-sanitized,easylist|breakage:minimal
pihole::profile::moderate:pi-setup/profiles/moderate.yaml|domains:~300k|lists:light+adguard-full+easyprivacy|breakage:rare
pihole::profile::aggressive:pi-setup/profiles/aggressive.yaml|domains:~1M+|lists:moderate+oisd+1hosts+hagezi|breakage:expected|default:false

# Pi-hole Resources
pihole::db::gravity:gravity.db|path:/etc/pihole|tables:adlist,domainlist,gravity,info|sudo:read-write|access:local-executor
pihole::db::ftl:pihole-FTL.db|path:/etc/pihole|tables:queries,network|sudo:read-only|access:local-executor
pihole::command::status:pihole status|sudo:false|output:service-status|via:execute_command
pihole::command::gravity:pihole -g|sudo:true|purpose:rebuild-blocklists|duration:varies|via:execute_command
pihole::command::whitelist:pihole -w domain.com|sudo:true|purpose:add-whitelist|via:execute_command
pihole::command::blacklist:pihole -b domain.com|sudo:true|purpose:add-blacklist|via:execute_command
pihole::command::update:pihole -up|sudo:true|purpose:update-pihole|via:execute_command
pihole::command::restart:pihole restartdns|sudo:true|purpose:restart-dns-service|via:execute_command
pihole::command::flush:pihole flush|sudo:true|purpose:clear-logs|via:execute_command

# System Services
pi::service::pihole-ftl:pihole-FTL|desc:dns-dhcp|status:active|port:53|systemd:true
pi::service::lighttpd:lighttpd|desc:web-interface|status:active|port:80|systemd:true
pi::service::ssh:ssh|desc:ssh-server|status:active|port:22|systemd:true

# Local Execution Configuration
config::file::pi-config:/opt/pihole-manager/config.yaml|keys:web_url,router|location:pi|encrypted:router-password
config::file::state:/opt/pihole-manager/state.json|keys:setup_complete|location:pi|simple:true
config::file::sudoers:/etc/sudoers.d/pihole-manager|purpose:passwordless-sudo|grants:pihole-commands|validated:visudo

# Router Integration (optional - SSH from Pi to router)
router::model::tplink:AXE5400|api:tplinkrouterc6u|features:device-list,mac-block,reboot|partial:dhcp,bandwidth,guest|ssh:pi-to-router
router::auth::encrypted:config.yaml|storage:fernet-encrypted|security:medium|optional:true
